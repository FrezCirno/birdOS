
;----------------------------------------------------------------------------
; 函数名: PrintLine
;----------------------------------------------------------------------------
; 作用:
;   显示一个字符串
;----------------------------------------------------------------------------
; 参数:
;   es:bp = 字符串地址
;   bh    = 页号
;   bl    = 颜色
;   dh    = 行号
;   dl    = 列号
;   cx    = 字符串长度
;----------------------------------------------------------------------------
PrintLine:
    mov ax, 0x1301  ; 显示字符串 (AH = 13, int 0x10)
                    ; 字符串中只含显示字符，其显示属性在BL中。显示后，光标位置改变 (AL = 01h)
    mov bx, 0x0007  ; 页, 颜色
    int 0x10
    ret

;----------------------------------------------------------------------------
; 函数名: ReadSector
;----------------------------------------------------------------------------
; 作用:
;   读取软盘
;----------------------------------------------------------------------------
; 参数:
;   es:bx = 目标地址
;   dl    = 驱动器号
;   dh    = 柱面号(0-1)
;   ch    = 磁道号(0-79)
;   cl    = 起始扇区号(1-18)
;   al    = 扇区数量(<=19-cl)
;----------------------------------------------------------------------------
; 输出:
;   ah    = 02
;   si    = 尝试次数
;   失败超过5次会跳转到error
;----------------------------------------------------------------------------
ReadSector:
    mov ah, 2
    push ax
    mov si, 0 ; 失败次数
    jmp .retry
.fail:
    ; 失败
    inc si
    ; 失败5次
    cmp si, 5
    jae error
    ; 重置A驱动器, 重读
    mov ah, 0 ; 复位
    int 0x13
.retry:
    pop ax
    push ax
    int 0x13
    jc .fail ; 错误时 CFLAG = 1
    pop ax
    ret
